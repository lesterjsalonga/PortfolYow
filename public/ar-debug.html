<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Debug - Business Card Test</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        .ar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1001;
            pointer-events: none;
        }
        
        .ar-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            pointer-events: all;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .ar-debug {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 80px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            pointer-events: all;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .status {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .status.success { background: rgba(76, 175, 80, 0.3); }
        .status.error { background: rgba(244, 67, 54, 0.3); }
        .status.warning { background: rgba(255, 152, 0, 0.3); }
    </style>
</head>
<body style="margin: 0px; overflow: hidden;">
    <div class="ar-overlay">
        <button class="ar-close-btn" onclick="window.close(); window.history.back();">
            âœ•
        </button>
        <div class="ar-debug">
            <h4>AR Debug Console</h4>
            <div id="debug-log">
                <div class="status">Initializing AR...</div>
            </div>
            <div style="margin-top: 10px;">
                <button onclick="testHiro()" style="margin: 2px; padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer;">Test Hiro</button>
                <button onclick="testBusinessCard()" style="margin: 2px; padding: 5px 10px; background: #2196F3; color: white; border: none; border-radius: 3px; cursor: pointer;">Test Business Card</button>
            </div>
        </div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="logarithmicDepthBuffer: true; antialias: true;"
        embedded
        style="height: 100vh; width: 100vw;"
    >
        <a-assets>
            <a-asset-item id="dinosaur" src="/assets/3d-models/walking_indominus_rex.glb"></a-asset-item>
        </a-assets>

        <!-- Business Card Marker -->
        <a-marker 
            id="business-card-marker"
            type="pattern" 
            url="/assets/ar-markers/business-card-pattern.patt"
            smooth="true" 
            smoothCount="5" 
            smoothTolerance="0.1" 
            smoothThreshold="2"
        >
            <!-- Simple test cube first -->
            <a-box 
                id="test-cube"
                position="0 0.5 0" 
                scale="0.5 0.5 0.5" 
                color="red"
                visible="true"
            ></a-box>
            
            <!-- Dinosaur model -->
            <a-entity
                id="dinosaur-entity"
                gltf-model="#dinosaur"
                position="0 -0.5 0"
                scale="1.8 1.8 1.8"
                rotation="0 0 0"
                animation-mixer="clip: *; loop: repeat"
                visible="false"
            ></a-entity>
        </a-marker>

        <!-- Hiro Marker for comparison -->
        <a-marker 
            id="hiro-marker"
            preset="hiro" 
            smooth="true" 
            smoothCount="5" 
            smoothTolerance="0.1" 
            smoothThreshold="2"
            visible="false"
        >
            <a-box 
                position="0 0.5 0" 
                scale="0.5 0.5 0.5" 
                color="green"
            ></a-box>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let debugLog = document.getElementById('debug-log');
        
        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }
        
        function testHiro() {
            document.getElementById('hiro-marker').setAttribute('visible', true);
            document.getElementById('business-card-marker').setAttribute('visible', false);
            addLog('Switched to Hiro marker test', 'warning');
        }
        
        function testBusinessCard() {
            document.getElementById('business-card-marker').setAttribute('visible', true);
            document.getElementById('hiro-marker').setAttribute('visible', false);
            addLog('Switched to Business Card marker test', 'warning');
        }
        
        function showDinosaur() {
            document.getElementById('test-cube').setAttribute('visible', false);
            document.getElementById('dinosaur-entity').setAttribute('visible', true);
            addLog('Showing dinosaur model', 'success');
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const scene = document.querySelector('a-scene');
            
            scene.addEventListener('loaded', function() {
                addLog('A-Frame scene loaded successfully', 'success');
            });
            
            // Monitor marker detection
            const businessCardMarker = document.getElementById('business-card-marker');
            const hiroMarker = document.getElementById('hiro-marker');
            
            businessCardMarker.addEventListener('markerFound', function() {
                addLog('Business card marker detected!', 'success');
                setTimeout(showDinosaur, 2000); // Show dinosaur after 2 seconds
            });
            
            businessCardMarker.addEventListener('markerLost', function() {
                addLog('Business card marker lost', 'warning');
            });
            
            hiroMarker.addEventListener('markerFound', function() {
                addLog('Hiro marker detected!', 'success');
            });
            
            hiroMarker.addEventListener('markerLost', function() {
                addLog('Hiro marker lost', 'warning');
            });
            
            // Check if pattern file loads
            fetch('/assets/ar-markers/business-card-pattern.patt')
                .then(response => {
                    if (response.ok) {
                        addLog('Business card pattern file loaded successfully', 'success');
                    } else {
                        addLog('Failed to load business card pattern file', 'error');
                    }
                })
                .catch(error => {
                    addLog('Error loading pattern file: ' + error.message, 'error');
                });
        });
    </script>
</body>
</html>